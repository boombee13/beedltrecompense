<script>
        const API_URL = 'https://script.google.com/macros/s/AKfycbwoKn0sBWgxZVHenqQJn-ky8ttWxREAoZykk4qnCUMEsBP48KyXhCC2upufaPzlJXo/exec'; // อย่าลืมใส่ URL ของคุณกลับเข้าไปนะครับ

        async function fetchData() {
            try {
                const response = await fetch(API_URL);
                const data = await response.json();
                
                const tbody = document.querySelector('#dataTable tbody');
                tbody.innerHTML = ''; // เคลียร์ข้อความกำลังโหลด

                // ฟังก์ชันพิเศษ: ช่วยหาข้อมูลแม้ชื่อหัวคอลัมน์จะมีเว้นวรรค (Space) เกินมา
                const getValue = (row, keyName) => {
                    // ค้นหา key ที่ตัดเว้นวรรคหน้าหลังออกแล้วตรงกับที่เราต้องการ
                    const actualKey = Object.keys(row).find(k => k.trim() === keyName);
                    return actualKey ? row[actualKey] : '';
                };

                // กรองข้อมูล: เอาเฉพาะแถวที่มีข้อมูล "Date" หรือ "Link" จริงๆ
                const validData = data.filter(row => {
                    const dateVal = getValue(row, 'Date');
                    const linkVal = getValue(row, 'Link');
                    return (dateVal !== '' && dateVal !== undefined) || (linkVal !== '' && linkVal !== undefined);
                });

                // ตรวจสอบว่ามีข้อมูลหรือไม่
                if (validData.length === 0) {
                     tbody.innerHTML = '<tr><td colspan="7" style="text-align:center; padding: 20px;">ไม่พบข้อมูล (ระบบอาจหาชื่อหัวคอลัมน์ไม่เจอ)</td></tr>';
                     return;
                }

                // วนลูปสร้างตาราง
                validData.forEach(row => {
                    const tr = document.createElement('tr');
                    
                    // เตรียมลิงก์ (ถ้าไม่มีลิงก์ให้แสดงขีดแทน เพื่อไม่ให้ปุ่มพัง)
                    const linkImg = getValue(row, 'Link') ? `<a href="${getValue(row, 'Link')}" target="_blank">ดูรูปภาพ</a>` : '-';
                    const linkMap = getValue(row, 'Location') ? `<a href="${getValue(row, 'Location')}" class="btn" target="_blank">เปิด Google Maps</a>` : '-';

                    tr.innerHTML = `
                        <td>${getValue(row, 'Date') || '-'}</td>
                        <td>${getValue(row, 'Time') || '-'}</td>
                        <td>${linkImg}</td>
                        <td>${getValue(row, 'Sub District') || '-'}</td>
                        <td>${getValue(row, 'District') || '-'}</td>
                        <td>${linkMap}</td>
                        <td>${getValue(row, 'Status') || 'รอดำเนินการ'}</td>
                    `;
                    tbody.appendChild(tr);
                });
            } catch (error) {
                console.error('Error fetching data:', error);
                document.querySelector('#dataTable tbody').innerHTML = '<tr><td colspan="7" style="text-align:center; color: red;">เกิดข้อผิดพลาดในการโหลดข้อมูล API</td></tr>';
            }
        }

        fetchData();
    </script>
